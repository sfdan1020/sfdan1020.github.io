<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Space</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }

        .page-header {
            text-align: center;
            padding: 40px 20px 20px;
            margin-top: 20px;
        }

        .page-header h1 {
            margin: 0;
            color: #333;
            font-size: 28px;
        }

        .page-header p {
            color: #666;
            font-size: 16px;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 800px;
            margin: 20px auto;
            font-family: Arial, sans-serif;
        }

        .message-box {
            width: 45%;
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
    </style>
</head>
<body>

    <!-- Page Header with Title and Subtitle -->
    <div class="page-header">
        <h1>Welcome to your Member Space</h1>
        <p>If there are surveys available, they will appear here.</p>
    </div>

    <!-- Container for In-App Messages -->
    <div class="container">
        <div id="employment-inline-message" class="message-box">
            <p>Loading Employment message...</p>
        </div>
        
        <div id="automobiles-inline-message" class="message-box">
            <p>Loading Automobiles message...</p>
        </div>

        <div id="food-inline-message" class="message-box">
            <p>Loading Food message...</p>
        </div>

        <div id="entertainment-inline-message" class="message-box">
            <p>Loading Entertainment message...</p>
        </div>
    </div>

    <!-- Customer.io Tracking Script with Identification -->
    <script>
        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdp-eu.customer.io/v1/analytics-js/snippet/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._writeKey=key};analytics.SNIPPET_VERSION="4.15.3";
            
            // Basic Customer.io Tracking
            analytics.load("4f630e239b963a29f6ea"); // Your CDP API Key
        }}();

        // Check for cio_id parameter in the URL to identify the user
        const urlParams = new URLSearchParams(window.location.search);
        const cioId = urlParams.get('cio_id');

        if (cioId) {
            // Attempt to retrieve email from local storage if saved during registration
            const userEmail = localStorage.getItem("userEmail");

            // Identify the user with both cio_id and email to prevent duplicate profiles
            if (window.analytics) {
                const identifyAttributes = userEmail ? { email: userEmail } : {}; // Only add email if available
                analytics.identify(cioId, identifyAttributes); // Identify user
                analytics.page(); // Track page view after identifying the user
                console.log("Page view tracked for cio_id:", cioId);
            } else {
                console.error("Customer.io analytics not loaded.");
            }
        } else {
            alert("Access denied: You must access this page through the verification link.");
            window.location.href = "https://sfdan1020.github.io/index.html"; // Redirect to the registration page
        }
    </script>
</body>
</html>
