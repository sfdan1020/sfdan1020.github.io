<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restricted Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }

        .page-header {
            text-align: center;
            padding: 40px 20px 20px;
            margin-top: 20px;
        }

        .page-header h1 {
            margin: 0;
            color: #333;
            font-size: 28px;
        }

        .page-header p {
            color: #666;
            font-size: 16px;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 800px;
            margin: 20px auto;
        }

        .message-box {
            width: 45%;
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
    </style>
</head>
<body>

    <!-- Page Header with Title and Subtitle -->
    <div class="page-header">
        <h1>Welcome to your Member Space</h1>
        <p>Your surveys are loading! If any are available, they’ll appear here shortly</p>
    </div>

    <!-- Container for In-App Messages with Default Content -->
    <div class="container">
        <div id="employment-inline-message" class="message-box">
            <p id="employment-content">Explore Employment opportunities tailored for you. Loading...</p>
        </div>
        
        <div id="automobiles-inline-message" class="message-box">
            <p id="automobiles-content">If you’re interested in automobiles, keep an eye out here! Loading...</p>
        </div>

        <div id="food-inline-message" class="message-box">
            <p id="food-content">We're looking for foodies. Loading...</p>
        </div>

        <div id="entertainment-inline-message" class="message-box">
            <p id="entertainment-content">Review your favorite movies! Loading..</p>
        </div>
    </div>

    <!-- Customer.io Tracking Script with Inline In-App Messaging Enabled -->
    <script>
        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdp-eu.customer.io/v1/analytics-js/snippet/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._writeKey=key;analytics._loadOptions=e};analytics.SNIPPET_VERSION="4.15.3";
               analytics.load(
                   "4f630e239b963a29f6ea", // Your CDP API Key
                   { 
                       "integrations": {
                           "Customer.io In-App Plugin": { 
                               siteId: "8659cdcca668fb939ffa" // Your API ID for in-app messaging
                           }
                       }
                   }
               );
               analytics.page(); // Track page view for in-app messaging trigger
           }}();

           // Check for cio_id parameter in the URL
           const urlParams = new URLSearchParams(window.location.search);
           const cioId = urlParams.get('cio_id');

           // Redirect if cio_id is missing
           if (!cioId) {
               alert("Access denied: You must access this page through the verification link.");
               window.location.href = "https://sfdan1020.github.io/index.html"; // Redirect to the registration page
           } else {
               // Track page view for the user with Customer.io page() after identify
               if (window.analytics) {
                   analytics.page(); // Track page view without creating/modifying profile
                   console.log("Page view tracked for cio_id:", cioId);
               } else {
                   console.error("Customer.io analytics not loaded.");
               }
           }

           // Event listener for in-app message dismissal or interaction
           function restoreDefaultContent() {
               document.getElementById("employment-content").innerHTML = "Did you know? By answering profiling questions like this, you’re boosting your chances of qualifying!";
               document.getElementById("automobiles-content").innerHTML = "It’s normal not to qualify for a survey! For example, if we’re looking for people who made a purchase last week, we can’t always predict if that’s you!";
               document.getElementById("food-content").innerHTML = "On average, you’ll qualify for 3 out of every 10 surveys you try. We’ll let you know right at the start, so you don’t waste any time!";
               document.getElementById("entertainment-content").innerHTML = "Sometimes surveys won’t be available, but don’t worry! Check back later, or we’ll keep you posted via email.";
           }

           // Assume Customer.io provides a function to listen for in-app dismiss
           if (window.analytics) {
               analytics.on('inAppMessage:dismiss', restoreDefaultContent);
               analytics.on('inAppMessage:click', restoreDefaultContent); // Restore after click as well
           }
   </script>
</body>
</html>
