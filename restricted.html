<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restricted Page</title>
</head>
<body>
    <div class="container">
        <h1>Welcome to the Restricted Page</h1>
        <p>This page is accessible only through the verification link.</p>
    </div>

    <!-- Customer.io Tracking Script -->
    <script>
        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdp-eu.customer.io/v1/analytics-js/snippet/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._writeKey=key;analytics._loadOptions=e};analytics.SNIPPET_VERSION="4.15.3";
            analytics.load("4f630e239b963a29f6ea"); 
            analytics.page();
        }}();

        // Check for email or cio_id parameter in the URL
        const urlParams = new URLSearchParams(window.location.search);
        const userEmail = urlParams.get('email');
        const cioId = urlParams.get('cio_id');
        const firstName = urlParams.get('first_name'); // Optional parameter
        const lastName = urlParams.get('last_name');   // Optional parameter

        // Redirect if both email and cio_id are missing
        if (!userEmail && !cioId) {
            alert("Access denied: You must access this page through the verification link.");
            window.location.href = "https://sfdan1020.github.io/index.html"; // Redirect to the registration page
        } else {
            // Prepare the attributes object to avoid overwriting existing attributes
            const attributes = {
                email: userEmail || null,
                cio_id: cioId || null
            };
            
            // Conditionally add first_name and last_name if they are present in the URL
            if (firstName) attributes.first_name = firstName;
            if (lastName) attributes.last_name = lastName;

            // Identify the user in Customer.io
            if (window.analytics) {
                const identifier = userEmail || cioId;
                analytics.identify(identifier, attributes);
                console.log("User identified with identifier:", identifier, attributes);
            } else {
                console.error("Customer.io analytics not loaded.");
            }
        }
    </script>
</body>
</html>
